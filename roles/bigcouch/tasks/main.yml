---
- include_vars: secrets.yml

- name: Install BigCouch
  yum:
    name: kazoo-bigcouch
    state: latest

- name: Start and Enable BigCouch
  service:
    name: kazoo-bigcouch
    state: started
    enabled: yes

- name: Create Bigcouch local.ini
  template:
    src: local.ini.j2
    dest: /etc/kazoo/bigcouch/local.ini
    owner: bigcouch
  notify: Restart Bigcouch

- name: Allow BigCouch Port 5984
  firewalld:
    port: 5984/tcp
    permanent: true
    immediate: true
    state: enabled

- name: Allow Bigcouch Port 5986
  firewalld:
    port: 5986/tcp
    permanent: true
    immediate: true
    state: enabled

- name: Allow epmd Port
  firewalld:
    port: 4369/tcp
    permanent: true
    immediate: true
    state: enabled

- name: Allow Distributed Erlang Ports
  firewalld:
    port: 11500-11999/tcp
    permanent: true
    immediate: true
    state: enabled

